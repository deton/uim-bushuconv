uim-bushuconv
=============

uim-bushuconvは、部首合成変換を行うための
[uim](http://code.google.com/p/uim/)用IMです。

* 複数の部首を指定することで、漢字候補の絞り込みが可能

    + "木"→「來杏栄楽橿樺株柑棺閑机棋...」(候補数470)
    + "木口"→「杏呆格桔梧槍枷枴枳枸桾椥...」(候補数29)

* 画数ごとの部首リストから選択(部首の読み方がわからなくてもOK)

    + 1→「17くしろレ一乙丶丿亅」
    + 2→「5いうへよイクコソトナマメラリ七十人丁刀二入八又了力亠儿冂冖...」
    + 3→「4アオキケサシツヨ干久弓巾己口工三山士子女小上寸千川大土之万...」
    + 4→「えネホヰ王火牙牛斤欠月戸五午止氏尺手心水太中爪斗日巴不夫父...」
    + 5→「央可禾且甘丘去玄乎古甲皿司史四示失主出申世生石田乍白皮疋付...」
    + 6→「衣羽臼回休共曲向行合艮糸至寺而耳自朱州西虫兆同米亦羊朿耒聿」
    + 7→「亜貝角求見言呉更告車初臣身赤走束足辰谷沈弟豆酉売里呂冏豕豸」
    + 8→「雨果学官京金実者受尚垂性青斉其長東非並免門亟侖帚隹」
    + 9→「革首乗食是前段追点度独南派飛品風頁面兪咸咼奐昜曷禺」
    + 10→「華害鬼兼高骨馬莫病流冓叟韋」
    + 11→「魚深部菫」
    + 12→「開寒検滋湿朝復無」
    + 13→「愛漢新鼠電」
    + 14→「関」
    + 15→「寮」
    + 17→「襄」

uim-tutcodeの対話的な部首合成変換機能を使っています。

インストール
============

./install.sh

準備
====

uim-pref-gtkやuim-pref-qt4を起動し、
「全体設定」→「使用可能にする入力方式」を編集し、
"bushuconv"を有効にしてください。

キーボードを使ってbushuconv IMに切り替えるには、
「ホットキーによる入力方式の一時切り替えを有効にする」を
チェックしてください。

「TUT-Code」→「対話的な部首合成変換を有効にする」にチェックを入れた上で、
部首合成変換辞書ファイルのパスを「bushu.index2ファイル」と
「bushu.expandファイル」に設定してください。
部首合成変換辞書は、http://deton.github.com/uim-bushuconv/tc-bushudic-2.3.1-22.6.tar.bz2 からダウンロード可能です。

使用方法
========

uim-toolbarや「一時切り替えキー」を使って、bushuconv IM
(アイコン: ![アイコン](https://github.com/deton/uim-bushuconv/raw/master/pixmaps/bushuconv.png))
に切り替えます。

(1)最初に、部首の画数に対応するキーを入力してください。
画数ごとに部首を分けています。

![例0](http://deton.github.com/uim-bushuconv/bushuconv-top.png)

例1: 画数4の部首を選ぶため、`4`キーを入力。

最初に入力するキーと画数の対応は以下。

* 1-9  画数1-9の部首候補
* 0    画数10の部首候補
* q    画数11の部首候補
* w    画数12の部首候補
* e    画数13の部首候補
* r    「関」(画数14の部首)
* t    「寮」(画数15の部首)
* y    「襄」(画数17の部首)
* u    「3」(その他。「蟲」「毳」「橸」等、同じ部品3つから成る漢字の合成用)

(2)次に、候補ウィンドウに表示されている、その画数の部首候補から、
目あての部首を選択するか、
候補ウィンドウ上で表示されているラベルキーを入力してください。

例2: 部首として、"木"を選択(`v`キーを入力)。

![例2](http://deton.github.com/uim-bushuconv/bushuconv-4.png)

(3)そうすると、選択された部首を使って合成可能な漢字の候補が表示されます。

例3: 漢字候補として、「來杏栄楽橿樺株柑棺閑机棋...」が表示されます(候補数470)。

![例3](http://deton.github.com/uim-bushuconv/bushuconv-4v.png)

(4)最後に、候補ウィンドウに表示された中から漢字を選ぶと確定されます。

(5)なお、(3)の状態で、続けて新たな部首を入力((1)からの手順と同様)すると、
入力した全ての部首を使って合成可能な漢字の候補が表示されます。
つまり、部首を追加していくことで、漢字候補を絞り込むことができます。

例4: 画数3の部首を追加するため、`3`キーを入力。

![例4](http://deton.github.com/uim-bushuconv/bushuconv-4v3.png)

例5: 部首として、"口"を選択(`t`キーを入力)。

例6: 漢字候補として、「杏呆格桔梧槍枷枴枳枸桾椥...」が表示されます(候補数29)。

![例6](http://deton.github.com/uim-bushuconv/bushuconv-4v3t.png)

例7: 漢字として、「枳」を確定(`l`キーを入力)。

(6)なお、新たに入力した部首を組み合わせると何も合成できない場合は、
その部首は部首リストに追加されません。

例8: 例6の状態で、`5` `1` と入力して、部首として"央"を選択しても、
"央"は部首リストに追加されず、"木口"を対象とした漢字候補が再表示されます。

入力状態
========

以下の2つの入力状態があります。
各状態で、使用可能なキーが異なります。

* 部首画数選択状態(1)(例0画面) + 漢字選択状態(3)(4)(5)(例3、例6画面)

    「▼」のみや、「▼木<u>=>來</u>」のように、
    漢字候補が下線付きで`=>`の後に表示されている状態。

    + 部首画数を指定するキー:

            1 2 3 4 5  6 7 8 9 0
            q w e r t  y u

    + 漢字を選択するキー: 

            a s d f g  h j k l ;
            z x c v b  n m , . /
            Q W E R T  Y U I O P
            A S D F G  H J K L +
            Z X C V B  N M < > ?

* 部首選択状態(2)(例2、例4画面)

    「▼<u>4</u>」や「▼木<u>3=>來</u>」のように、
    直前に入力した部首画数を指定するキー(例:4や3)が
    下線付きで表示されている状態。

        1 2 3 4 5  6 7 8 9 0
        q w e r t  y u i o p
        a s d f g  h j k l ;
        z x c v b  n m , . /
        Q W E R T  Y U

キーと処理の対応
================

* Ctrl+g  デフォルトのIMに切り替える
* ~       デフォルトのIMに切り替える

カスタマイズ項目
================

* 漢字確定後にデフォルトIMに切り替えるかどうか (デフォルト: #f)

カスタマイズ項目(uim-tutcode)
-----------------------------
uim-tutcodeの対話的な部首合成変換機能を使っているので、
uim-tutcode側の設定が反映されます。

* 部首選択時の候補表示数:記号モードにおいて候補ウィンドウに一度に表示する候補数 (縦・横候補ウィンドウ時のデフォルト: 10)
* 部首から合成される漢字候補表示数:補完/予測において候補ウィンドウに一度に表示する候補数 (縦・横候補ウィンドウ時のデフォルト: 10)

* bushu.helpファイル

    部首合成変換用ユーザ辞書(EUC-JP)。
    このファイルの内容を優先して漢字候補に出します。

    例:"イ"と"専"や、"伝"と"・"で"傳"を合成したい場合、
    以下の行を追加してください。
    逆の順番("専"と"イ")でも合成したい場合は、後ろに"*"を付けてください。

        傳イ専* 伝・

備考
====

http://deton.github.com/uim-bushuconv/tc-bushudic-2.3.1-22.6.tar.bz2
にある部首合変換辞書には、JIS第1・第2水準の漢字のみ含まれます
(第3・第4水準やUnicodeにしかない漢字は含まれません)。

[uim-tutcodeの対話的な部首合成変換機能](http://code.google.com/p/uim-doc-ja/wiki/UimTutcode#%E5%AF%BE%E8%A9%B1%E7%9A%84%E3%81%AA%E9%83%A8%E9%A6%96%E5%90%88%E6%88%90%E5%A4%89%E6%8F%9B)
を使っています。
対話的な部首合成変換機能は、
もともとEmacs用T-Code入力環境tc2で作られたものです。
つまり、T-Codeで直接入力可能な漢字を部品として使って
漢字を合成することを意図したものなので、
漢字辞典の部首とは異なる場合があります
(例:"5"のように、形を使っているもの)。

関連
====

* uim-chardict-qt4

BUGS
====

縦候補ウィンドウ上で最初から選択されている候補をクリックしても、
確定されません。
(選択済候補の再選択とみなされて、IM側に候補選択通知が来ないため。
かといって、最初に何も選択しないようにすると、
どの候補をクリックしても候補選択通知が来なくなるし)
