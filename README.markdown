uim-bushuconv
=============

uim-bushuconvは、部首合成変換を行うための
[uim](http://code.google.com/p/uim/)用IMです。

uim-tutcodeの対話的な部首合成変換機能を使っています。

特徴
----

* 複数の部首を指定することで、漢字候補の絞り込みが可能

    + "木"→「杏栄楽橿樺株柑棺閑机棋棄杵朽業極桐栗桑桁枯梗構困...」(候補数470)
    + "木口"→「杏呆格桔梧槍枷枴枳枸桾椥架喋保檮榱橲櫺褒嘛噤堡...」(候補数29)

* 漢字の一部を部首として使って合成可能
* 複数の部首をクリップボードからペーストして入力可能
  (画数を数えて部首を選ぶのが面倒な場合向け)

    例:「觴」を合成する部首として、「傷」を入力したいが、
    9画「昜」から選ぶことがすぐにはわからず、
    4画「勿」から探しても見つからずまどろっこしい場合、
    「角傷」の2文字をペースト。

* 画数ごとの部首リストから選択(部首の読み方がわからなくてもOK)

    + 1→「17くしろレ一乙丶丿亅」
    + 2→「5いうへよイクコソトナマメラリ七十人丁刀二入八又了力亠儿冂冖...」
    + 3→「4ア部オ性独之キケサシツヨ干久弓巾己口工三山士子女小上寸千川...」
    + 4→「えネホヰ開沈点王火牙牛斤欠月戸五午止氏尺手心水太中爪斗日巴...」
    + 5→「学売病並実初電央可禾且甘丘去玄乎古甲皿司史四示失主出申世生...」
    + 6→「受関追派衣羽臼回休共曲向行合艮糸至寺而耳自朱州西虫兆同米亦羊朿耒聿」
    + 7→「度流亜貝角求見言呉更告車臣身赤走束足辰谷弟豆酉売里呂冏豕豸」
    + 8→「朝検深雨果官京金者受尚垂青斉其長東非並免門亟侖帚隹」
    + 9→「新復湿滋革首乗食是前段度南飛品風頁面兪咸咼奐昜曷禺」
    + 10→「寒漢華害鬼兼高骨馬莫冓叟韋勞」
    + 11→「魚菫」
    + 12→「寮朝復無」
    + 13→「襄愛新鼠」
    + 17→「襄」

インストール
============

./install.sh

準備
====

uim-pref-gtkやuim-pref-qt4を起動し、
「全体設定」→「使用可能にする入力方式」を編集し、
"bushuconv"を有効にしてください。

キーボードを使ってbushuconv IMに切り替えるには、
「ホットキーによる入力方式の一時切り替えを有効にする」を
チェックしてください。

「TUT-Code」→「対話的な部首合成変換を有効にする」にチェックを入れた上で、
部首合成変換辞書ファイルのパスを「bushu.index2ファイル」と
「bushu.expandファイル」に設定してください。
部首合成変換辞書は、http://deton.github.com/uim-bushuconv/tc-bushudic-2.3.1-22.6.tar.bz2 からダウンロード可能です。

クリップボードから部首のペーストを行うには、
「TUT-Code キー設定1」→「クリップボードから貼り付け」キーに
`<Control>v`等を設定してください。
なお、クリップボードからテキストを取得するのに、
uimのtext acquisition API(surrounding text API)を使うので、
text acquisition APIに対応した以下のブリッジでのみ動作します。

  * uim-gtk
  * uim-qt4
  * uim-qt3
  * MacUIM 0.6.15-1

使用方法
========

uim-toolbarや「一時切り替えキー」を使って、bushuconv IM
(アイコン: ![アイコン](https://github.com/deton/uim-bushuconv/raw/master/pixmaps/bushuconv.png))
に切り替えます。

(1)最初に、部首の画数に対応するキーを入力してください。
画数ごとに部首を分けています。

![例0](http://deton.github.com/uim-bushuconv/bushuconv-top.png)

例1: 画数3の部首を選ぶため、`3`キーを入力。

最初に入力するキーと画数の対応は以下。

* 1-9  画数1-9の部首候補
* 0    画数10の部首候補
* q    画数11の部首候補
* w    画数12の部首候補
* e    画数13の部首候補
* r    「襄」(画数17の部首)
* t    「3」(その他。「蟲」「毳」「橸」等、同じ部品3つから成る漢字の合成用)

(2)次に、候補ウィンドウに表示されている、その画数の部首候補から、
目あての部首を選択するか、
候補ウィンドウ上で表示されているラベルキーを入力してください。

例2: 部首として、"サ"を選択(`0`キーを入力)。

![例2](http://deton.github.com/uim-bushuconv/bushuconv-3.png)

(3)そうすると、選択された部首を使って合成可能な漢字の候補が表示されます。

例3: 漢字候補として、「茜葦芦芋英荻苛菓芽蓋葛...」が表示されます(候補数325)。

![例3](http://deton.github.com/uim-bushuconv/bushuconv-30.png)

(4)最後に、候補ウィンドウに表示された中から漢字を選ぶと確定されます。

(5)なお、(3)の状態で、続けて新たな部首を入力((1)からの手順と同様)すると、
入力した全ての部首を使って合成可能な漢字の候補が表示されます。
つまり、部首を追加していくことで、漢字候補を絞り込むことができます。

例4: 画数5の部首を追加するため、`5`キーを入力。

![例4](http://deton.github.com/uim-bushuconv/bushuconv-305.png)

例5: 部首として、"禾"を選択(`0`キーを入力)。

例6: 漢字候補として、「萎萩莪莉萪蓁藜莠蘓薐」が表示されます(候補数10)。

![例6](http://deton.github.com/uim-bushuconv/bushuconv-3050.png)

例7: 漢字として、「萪」を確定(`g`キーを入力)。

(6)なお、新たに入力した部首を組み合わせると何も合成できない場合は、
その部首は部首リストに追加されません。

例8: 例6の状態で、`4` `8` と入力して、部首として"王"を選択しても、
"王"は部首リストに追加されず、"サ禾"を対象とした漢字候補が再表示されます。

独特な部首の使い方
==================

[uim-tutcodeの対話的な部首合成変換機能](http://code.google.com/p/uim-doc-ja/wiki/UimTutcode#%E5%AF%BE%E8%A9%B1%E7%9A%84%E3%81%AA%E9%83%A8%E9%A6%96%E5%90%88%E6%88%90%E5%A4%89%E6%8F%9B)
を使っています。
対話的な部首合成変換機能は、
もともとEmacs用の漢字直接入力環境tc2で作られたものです。
つまり、漢字直接入力方式のT-Code等で直接入力可能な漢字を部品として使って
漢字を合成することを意図したものなので、
漢字辞典の部首とは異なる場合があります。

例えば、「りっしんべん」を代表する文字として「性」が使われています。

+ 1画
    + 1→たてぼう (引 状 弔 个)
+ 2画
    + 7→(幻 成 丐)
    + く→(彑 互 瓦)
    + し→(及 丈 匁 乂)
    + ろ→(乃 及)
    + レ→(札 尤 仰)
    + 5→(朽 号 考 与 咢)
    + い→(以)
    + う→(永)
    + へ→(介 今 余 舎)
    + よ→(與)
    + イ→にんべん (化 代)
    + ク→(色 危 争 夐 憺)
    + コ→(巨 暇 鹿)
    + ソ→(悦 曽 逆 半 平 并)
    + ト→ぼくのと (外 占 卓 攴)
    + ナ→(右 左 布 尤 友 有)
    + マ→(通 勇)
    + メ→(刈 凶 区 肴 殺 爾 駁)
    + ラ→(今)
    + リ→りっとう (利 列)
    + 風→(夙 凧 凪 鳳 / 楓 嵐 瘋 虱 諷 颪 颱)
+ 3画
    + 4→(収、爿)
    + ア→こざとへん (阿 隆)
    + 部→おおざと (郊 邦)
    + オ→てへん (打 払)
    + 性→りっしんべん (快 情)
    + 独→けものへん (狩 猫)
    + 之→しんにょう (進 込)
    + キ→(半 奉)
    + ケ→(竹 乞 尓)
    + サ→くさかんむり (草 芥)
    + シ→さんずい (海 波)
    + ツ→(畄 鼡 単)
    + ヨ→(浸 当)
+ 4画
    + え→2点しんにょう (辷 遙 遽)
    + ネ→ねへん (社 祈)
    + ホ→(痲)
    + ヰ→(舛)
    + 開→開-門 (刑 形 研 発)
    + 沈→沈-シ (耽 枕)
    + 点→れっか/れんが (焦 然)
+ 5画
    + 学→学-子 (営 栄 覚 蛍 労 鴬)
    + 実→実-宀 (春 秦 奏 泰 奉 舂)
    + 初→ころもへん (袖 被)
    + 電→電-雨 (奄 亀 竜 縄 黽)
    + 売→売-儿 (壱 壷 壹 孛 / 殻 続)
    + 病→やまいだれ (疫 痛)
    + 並→(並の下側) (虚 業 晋 普 僕 霊 椪 黹)
    + 四→あみがしら (罪 置)
+ 6画
    + 関→関-門 (咲 送 朕 渕 鎹)
    + 受→受-又 (妥 舜 爵 / 授 綬)
    + 追→追-之 (師 帥 阜)
    + 派→派-シ (脈)
+ 7画
    + 度→度-又 (庶 席 / 渡 鍍)
    + 流→流-シ (疏 琉 硫 旒 梳 毓 醯)
+ 8画
    + 検→検-木 (倹 剣 険 験 鹸 剱)
    + 深→深-シ (探)
    + 朝→朝-月 (斡 乾 幹 翰 韓 戟 / 潮 廟 嘲)
+ 9画
    + 滋→滋-シ (慈 磁)
    + 湿→湿-シ (顕 隰)
    + 新→新-斤 (親 / 薪 噺)
    + 復→復-彳 (腹 複 愎 蝮 輹 馥 鰒 / 覆 履)
+ 10画
    + 寒→寒-冫 (塞 搴 寨 謇 賽 蹇 騫)
    + 漢→漢-シ (嘆 歎 難 艱)
    + 勞→勞-力 (榮 煢 犖 瑩 癆 螢 鶯)
+ 12画
    + 寮→寮-宀 (隙 僚 療 瞭 遼 撩 暸 潦 燎 繚 鐐 鷯)
+ その他
    + 3→「蟲」「毳」「橸」等、同じ部品3つから成る漢字の合成用

入力状態
========

以下の2つの入力状態があります。
各状態で、使用可能なキーが異なります。

* 部首画数選択状態(1)(例0画面) + 漢字選択状態(3)(4)(5)(例3、例6画面)

    「▼」のみや、「▼サ<u>=>茜</u>」のように、
    漢字候補が下線付きで`=>`の後に表示されている状態。

    + 部首画数を指定するキー:

            1 2 3 4 5  6 7 8 9 0
            q w e r t

    + 漢字を選択するキー: 

            a s d f g  h j k l ;
            z x c v b  n m , . /
            Q W E R T  Y U I O P
            A S D F G  H J K L +
            Z X C V B  N M < > ?

* 部首選択状態(2)(例2、例4画面)

    「▼<u>3</u>」や「▼サ<u>5=>茜</u>」のように、
    直前に入力した部首画数を指定するキー(例:3や5)が
    下線付きで表示されている状態。

        1 2 3 4 5  6 7 8 9 0
        q w e r t  y u i o p
        a s d f g  h j k l ;
        z x c v b  n m , . /
        Q W E R T  Y U I O P
        A S D F

キーと処理の対応
================

* Ctrl+g  デフォルトのIMに切り替える
* ~       デフォルトのIMに切り替える
* tab     変換前の部首を確定する
* right   選択中の漢字候補を部首として使って、部首合成変換を行う

カスタマイズ項目
================

* 漢字確定後にデフォルトIMに切り替えるかどうか (デフォルト: #f)

カスタマイズ項目(uim-tutcode)
-----------------------------
uim-tutcodeの対話的な部首合成変換機能を使っているので、
uim-tutcode側の設定が反映されます。

* 部首選択時の候補表示数:記号モードにおいて候補ウィンドウに一度に表示する候補数 (縦・横候補ウィンドウ時のデフォルト: 10)
* 部首から合成される漢字候補表示数:補完/予測において候補ウィンドウに一度に表示する候補数 (縦・横候補ウィンドウ時のデフォルト: 10)

* bushu.helpファイル

    部首合成変換用ユーザ辞書(EUC-JP)。
    このファイルの内容を優先して漢字候補に出します。

    例:"イ"と"専"や、"伝"と"・"で"傳"を合成したい場合、
    以下の行を追加してください。
    逆の順番("専"と"イ")でも合成したい場合は、後ろに"*"を付けてください。

        傳イ専* 伝・

備考
====

* http://deton.github.com/uim-bushuconv/tc-bushudic-2.3.1-22.6.tar.bz2
  にある部首合変換辞書には、JIS第1・第2水準漢字(JIS X 0208)のみ含まれます
  (第3・第4水準漢字(JIS X 0213)、補助漢字(JIS X 0212)や
  Unicodeにしかない漢字は含まれません)。

関連
====

* uim-chardict-qt4

BUGS
====

* 縦候補ウィンドウ上で最初から選択されている候補をクリックしても、
  確定されません。
  (選択済候補の再選択とみなされて、IM側に候補選択通知が来ないため。
  かといって、最初に何も選択しないようにすると、
  どの候補をクリックしても候補選択通知が来なくなるし)

* クリップボードから部首のリストをペーストした際に、
  部首のリストの途中で、その部首を組み合わせると何も合成できなくなる場合、
  以降の部首は無視されます。
  (期待する動作は、その部首だけスキップ)
